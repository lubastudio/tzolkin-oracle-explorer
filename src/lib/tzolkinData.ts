
// 20 Solar Seals in order
export const solarSeals = [
  { name: "Dragão Vermelho", color: "red", description: "Nutrir, Nascimento" },
  { name: "Vento Branco", color: "white", description: "Espírito, Respiração" },
  { name: "Noite Azul", color: "blue", description: "Sonho, Abundância" },
  { name: "Semente Amarela", color: "yellow", description: "Atenção, Florescimento" },
  { name: "Serpente Vermelha", color: "red", description: "Sobrevivência, Instinto" },
  { name: "Enlaçador de Mundos Branco", color: "white", description: "Morte, Oportunidade" },
  { name: "Mão Azul", color: "blue", description: "Realização, Cura" },
  { name: "Estrela Amarela", color: "yellow", description: "Elegância, Arte" },
  { name: "Lua Vermelha", color: "red", description: "Purificação, Fluxo" },
  { name: "Cachorro Branco", color: "white", description: "Coração, Lealdade" },
  { name: "Macaco Azul", color: "blue", description: "Magia, Ilusão" },
  { name: "Humano Amarelo", color: "yellow", description: "Influência, Livre Arbítrio" },
  { name: "Caminhante do Céu Vermelho", color: "red", description: "Espaço, Exploração" },
  { name: "Mago Branco", color: "white", description: "Atemporalidade, Receptividade" },
  { name: "Águia Azul", color: "blue", description: "Visão, Mente" },
  { name: "Guerreiro Amarelo", color: "yellow", description: "Inteligência, Questionamento" },
  { name: "Terra Vermelha", color: "red", description: "Navegação, Sincronização" },
  { name: "Espelho Branco", color: "white", description: "Ordem, Sem Fim" },
  { name: "Tormenta Azul", color: "blue", description: "Energia, Auto Geração" },
  { name: "Sol Amarelo", color: "yellow", description: "Iluminação, Fogo Universal" },
];

// 13 Galactic Tones
export const galacticTones = [
  { name: "Magnético", number: 1, description: "Propósito" },
  { name: "Lunar", number: 2, description: "Desafio" },
  { name: "Elétrico", number: 3, description: "Serviço" },
  { name: "Auto-Existente", number: 4, description: "Forma" },
  { name: "Radial", number: 5, description: "Comando" },
  { name: "Rítmico", number: 6, description: "Equilíbrio" },
  { name: "Ressonante", number: 7, description: "Sintonia" },
  { name: "Galáctico", number: 8, description: "Integridade" },
  { name: "Solar", number: 9, description: "Intenção" },
  { name: "Planetário", number: 10, description: "Manifestação" },
  { name: "Espectral", number: 11, description: "Liberação" },
  { name: "Cristal", number: 12, description: "Cooperação" },
  { name: "Cósmico", number: 13, description: "Presença" },
];

// Months table data - values used for Dreamspell calculation
export const months = [
  { name: "Janeiro", value: 0 },
  { name: "Fevereiro", value: 31 },
  { name: "Março", value: 59 },
  { name: "Abril", value: 90 },
  { name: "Maio", value: 120 },
  { name: "Junho", value: 151 },
  { name: "Julho", value: 181 },
  { name: "Agosto", value: 212 },
  { name: "Setembro", value: 243 },
  { name: "Outubro", value: 13 },
  { name: "Novembro", value: 44 },
  { name: "Dezembro", value: 74 },
];

// Years table data with accurate values
export const yearValues = {
  "1754": 62, "1755": 167, "1756": 12, "1757": 117, "1758": 222, "1759": 67,
  "1760": 172, "1761": 17, "1762": 122, "1763": 227, "1764": 72, "1765": 177,
  "1766": 22, "1767": 127, "1768": 232, "1769": 77, "1770": 182, "1771": 27,
  "1772": 132, "1773": 237, "1774": 82, "1775": 187, "1776": 32, "1777": 137,
  "1778": 242, "1779": 87, "1780": 192, "1781": 37, "1782": 142, "1783": 247,
  "1784": 92, "1785": 197, "1786": 42, "1787": 147, "1788": 252, "1789": 97,
  "1790": 202, "1791": 47, "1792": 152, "1793": 257, "1794": 102, "1795": 207,
  "1796": 52, "1797": 157, "1798": 2, "1799": 107, "1800": 212, "1801": 57,
  "1802": 162, "1803": 7, "1804": 112, "1805": 217, "1806": 62, "1807": 167,
  "1808": 12, "1809": 117, "1810": 222, "1811": 67, "1812": 172, "1813": 17,
  "1814": 122, "1815": 227, "1816": 72, "1817": 177, "1818": 22, "1819": 127,
  "1820": 232, "1821": 77, "1822": 182, "1823": 27, "1824": 132, "1825": 237,
  "1826": 82, "1827": 187, "1828": 32, "1829": 137, "1830": 242, "1831": 87,
  "1832": 192, "1833": 37, "1834": 142, "1835": 247, "1836": 92, "1837": 197,
  "1838": 42, "1839": 147, "1840": 252, "1841": 97, "1842": 202, "1843": 47,
  "1844": 152, "1845": 257, "1846": 102, "1847": 207, "1848": 52, "1849": 157,
  "1850": 2, "1851": 107, "1852": 212, "1853": 57, "1854": 162, "1855": 7,
  "1856": 112, "1857": 217, "1858": 62, "1859": 167, "1860": 12, "1861": 117,
  "1862": 222, "1863": 67, "1864": 172, "1865": 17, "1866": 122, "1867": 227,
  "1868": 72, "1869": 177, "1870": 22, "1871": 127, "1872": 232, "1873": 77,
  "1874": 182, "1875": 27, "1876": 132, "1877": 237, "1878": 82, "1879": 187,
  "1880": 32, "1881": 137, "1882": 242, "1883": 87, "1884": 192, "1885": 37,
  "1886": 142, "1887": 247, "1888": 92, "1889": 197, "1890": 42, "1891": 147,
  "1892": 252, "1893": 97, "1894": 202, "1895": 47, "1896": 152, "1897": 257,
  "1898": 102, "1899": 207, "1900": 52, "1901": 157, "1902": 2, "1903": 107,
  "1904": 212, "1905": 57, "1906": 162, "1907": 7, "1908": 112, "1909": 217,
  "1910": 62, "1911": 167, "1912": 12, "1913": 117, "1914": 222, "1915": 67,
  "1916": 172, "1917": 17, "1918": 122, "1919": 227, "1920": 72, "1921": 177,
  "1922": 22, "1923": 127, "1924": 232, "1925": 77, "1926": 182, "1927": 27,
  "1928": 132, "1929": 237, "1930": 82, "1931": 187, "1932": 32, "1933": 137,
  "1934": 242, "1935": 87, "1936": 192, "1937": 37, "1938": 142, "1939": 247,
  "1940": 92, "1941": 197, "1942": 42, "1943": 147, "1944": 252, "1945": 97,
  "1946": 202, "1947": 47, "1948": 152, "1949": 257, "1950": 102, "1951": 207,
  "1952": 52, "1953": 157, "1954": 2, "1955": 107, "1956": 212, "1957": 57,
  "1958": 162, "1959": 7, "1960": 112, "1961": 217, "1962": 62, "1963": 167,
  "1964": 12, "1965": 117, "1966": 222, "1967": 67, "1968": 172, "1969": 17,
  "1970": 122, "1971": 227, "1972": 72, "1973": 177, "1974": 22, "1975": 127,
  "1976": 232, "1977": 77, "1978": 182, "1979": 27, "1980": 132, "1981": 237,
  "1982": 82, "1983": 187, "1984": 32, "1985": 137, "1986": 242, "1987": 87,
  "1988": 192, "1989": 37, "1990": 142, "1991": 247, "1992": 92, "1993": 197,
  "1994": 42, "1995": 147, "1996": 252, "1997": 97, "1998": 202, "1999": 47,
  "2000": 152, "2001": 257, "2002": 102, "2003": 207, "2004": 52, "2005": 157,
  "2006": 2, "2007": 107, "2008": 212, "2009": 57, "2010": 162, "2011": 7,
  "2012": 112, "2013": 217, "2014": 62, "2015": 167, "2016": 12, "2017": 117,
  "2018": 222, "2019": 67, "2020": 172, "2021": 17, "2022": 122, "2023": 227,
  "2024": 72, "2025": 177, "2026": 22, "2027": 127, "2028": 232, "2029": 77,
  "2030": 182, "2031": 27, "2032": 132, "2033": 237, "2034": 82, "2035": 187,
  "2036": 32, "2037": 137, "2038": 242, "2039": 87, "2040": 192
};

// Helper functions for Tzolkin calculations

// This is the original calculation function that we'll keep for compatibility
export const calculateKin = (year: string, month: number, day: number): number => {
  const yearValue = yearValues[year as keyof typeof yearValues] || 0;
  const monthValue = months[month]?.value || 0;
  
  let sum = yearValue + monthValue + day;
  
  // If sum is greater than 260, subtract 260 until it's in range 1-260
  while (sum > 260) {
    sum -= 260;
  }
  
  return sum;
};

// New calculation function that uses the fixed tables for accurate Kin calculation
export const calculateKinAccurate = (year: number, month: number, day: number): number => {
  const yearStr = year.toString();
  
  // Check if the year exists in our table
  if (!(yearStr in yearValues)) {
    console.warn(`Year ${yearStr} not in table, calculation may be inaccurate`);
    // Use nearest year or default calculation
    return calculateKin(yearStr, month - 1, day); // month - 1 because original function uses 0-based months
  }
  
  const yearValue = yearValues[yearStr as keyof typeof yearValues];
  
  // Get month value (month is 1-based in this function)
  const monthValue = months[month - 1]?.value || 0;
  
  // Calculate the sum
  let sum = yearValue + monthValue + day;
  
  // Normalize to range 1-260
  while (sum > 260) {
    sum -= 260;
  }
  
  // For Kin 0, return Kin 260
  return sum === 0 ? 260 : sum;
};

export const getKinComponents = (kin: number): {
  tone: typeof galacticTones[number],
  seal: typeof solarSeals[number]
} => {
  // Ensure kin is between 1-260
  const normalizedKin = ((kin - 1) % 260) + 1;
  
  // Calculate tone (1-13)
  const toneIndex = (normalizedKin - 1) % 13;
  
  // Calculate seal (0-19)
  const sealIndex = (normalizedKin - 1) % 20;
  
  return {
    tone: galacticTones[toneIndex],
    seal: solarSeals[sealIndex]
  };
};

export const calculateOracle = (kin: number) => {
  const { tone, seal } = getKinComponents(kin);
  const toneNumber = tone.number;
  
  // Extract the seal number (1-20)
  // In the Tzolkin, seals are 1-indexed
  const sealIndex = solarSeals.findIndex(s => s.name === seal.name);
  const sealNumber = sealIndex + 1; // Convert to 1-indexed
  
  // Calculate analog using the formula: 19 - seal number
  // If result is less than 1, add 20 to stay within the cycle
  let analogSealNumber = 19 - sealNumber;
  if (analogSealNumber <= 0) {
    analogSealNumber += 20;
  }
  
  // Calculate antipode using the formula: seal number + 10
  // If result is greater than 20, subtract 20 to stay within the cycle
  let antipodeSealNumber = sealNumber + 10;
  if (antipodeSealNumber > 20) {
    antipodeSealNumber -= 20;
  }
  
  // Calculate hidden (oculto) using the formula: 21 - seal number
  // The tone is 14 - tone number
  let hiddenSealNumber = 21 - sealNumber;
  if (hiddenSealNumber > 20) {
    hiddenSealNumber -= 20;
  }
  let hiddenToneNumber = 14 - toneNumber;
  if (hiddenToneNumber <= 0) {
    hiddenToneNumber += 13;
  }
  
  // Calculate guide (guia)
  // For tones 1 (Magnetic), 6 (Rhythmic), and 11 (Spectral), the guide is the kin itself
  if (toneNumber === 1 || toneNumber === 6 || toneNumber === 11) {
    return {
      guide: kin,
      analog: calculateKinWithToneAndSeal(toneNumber, analogSealNumber),
      antipode: calculateKinWithToneAndSeal(toneNumber, antipodeSealNumber),
      hidden: calculateKinWithToneAndSeal(hiddenToneNumber, hiddenSealNumber)
    };
  } else {
    // For other tones, calculate the guide based on the formula:
    // guia(selo, tom) = sequência_do_selo[(tom - 1) % 5]
    // We need to map this to an actual seal number
    
    // First, determine the color family based on the seal
    const colorFamily = Math.ceil(sealNumber / 4);
    
    // Use the (tone - 1) % 5 pattern to find the guide seal within the same color family
    let guideSealOffset = (toneNumber - 1) % 5;
    if (guideSealOffset === 0) guideSealOffset = 5;
    
    // Calculate the actual seal number
    let guideSealNumber = (colorFamily - 1) * 4 + guideSealOffset;
    if (guideSealNumber > 20) guideSealNumber = guideSealNumber - 20;
    if (guideSealNumber <= 0) guideSealNumber = guideSealNumber + 20;
    
    return {
      guide: calculateKinWithToneAndSeal(toneNumber, guideSealNumber),
      analog: calculateKinWithToneAndSeal(toneNumber, analogSealNumber),
      antipode: calculateKinWithToneAndSeal(toneNumber, antipodeSealNumber),
      hidden: calculateKinWithToneAndSeal(hiddenToneNumber, hiddenSealNumber)
    };
  }
};

// Helper function to calculate opposite tone (for hidden calculation)
const getOppositeTone = (toneNumber: number): number => {
  return 14 - toneNumber;
};

// Helper function to calculate a kin number based on tone and seal numbers
const calculateKinWithToneAndSeal = (toneNumber: number, sealNumber: number): number => {
  // Formula: (tone - 1) * 20 + seal
  let kin = (toneNumber - 1) * 20 + sealNumber;
  
  // Ensure it's within the 1-260 range
  if (kin <= 0) kin += 260;
  if (kin > 260) kin -= 260;
  
  return kin;
};

// Get color class for a kin
export const getKinColorClass = (kin: number): string => {
  const { seal } = getKinComponents(kin);
  
  switch (seal.color) {
    case 'red':
      return 'bg-tzolkin-red text-white';
    case 'white':
      return 'bg-tzolkin-white text-black';
    case 'blue':
      return 'bg-tzolkin-blue text-white';
    case 'yellow':
      return 'bg-tzolkin-yellow text-black';
    default:
      return 'bg-gray-500 text-white';
  }
};

// Calculate wave for a kin
export const calculateWave = (kin: number): number[] => {
  // Get the starting kin of the wave
  let waveStartKin = kin;
  
  // Find the first kin of the wave (with tone "Magnético")
  while ((waveStartKin - 1) % 13 !== 0) {
    waveStartKin--;
    if (waveStartKin < 1) {
      waveStartKin += 260;
    }
  }
  
  // Generate the 13 kins of the wave
  const waveKins: number[] = [];
  for (let i = 0; i < 13; i++) {
    let currentKin = waveStartKin + i;
    if (currentKin > 260) {
      currentKin -= 260;
    }
    waveKins.push(currentKin);
  }
  
  return waveKins;
};
